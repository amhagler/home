<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hagler Tools Terminal // Daily Dashboard</title>
  <meta name="description" content="Ari Hagler's classroom tool hub + daily agenda dashboard." />
  <style>
    :root{
      --bg0:#050816;
      --bg1:#071027;
      --ink:#EAF2FF;
      --muted:#A9B6D6;

      --mako:#35ffd6;
      --mako2:#24c8ff;
      --violet:#8b5cff;

      --brass:#d7b36a;
      --brass2:#b88c39;

      --danger:#ff5c7a;

      --panel: rgba(10,18,45,.62);
      --panel2: rgba(8,14,34,.72);
      --line: rgba(255,255,255,.14);
      --line2: rgba(53,255,214,.22);

      --shadow: 0 22px 80px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);

      --radius: 18px;
      --radius2: 26px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --serif: ui-serif, Georgia, "Times New Roman", serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family:var(--sans);
      background: radial-gradient(1400px 700px at 20% 0%, rgba(53,255,214,.14), transparent 55%),
                  radial-gradient(1200px 600px at 85% 12%, rgba(36,200,255,.10), transparent 58%),
                  radial-gradient(900px 500px at 50% 110%, rgba(183,140,57,.12), transparent 60%),
                  linear-gradient(180deg, var(--bg0), var(--bg1) 60%, #02040d);
      overflow-x:hidden;
    }

    /* CRT overlays */
    .crt::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        linear-gradient(to bottom, rgba(255,255,255,.045), rgba(255,255,255,0) 22%),
        repeating-linear-gradient(to bottom,
          rgba(0,0,0,.00) 0px,
          rgba(0,0,0,.00) 2px,
          rgba(0,0,0,.12) 3px,
          rgba(0,0,0,.00) 4px
        );
      mix-blend-mode: overlay;
      opacity:.55;
      z-index: 50;
    }
    .crt::after{
      content:"";
      position:fixed; inset:-10%;
      pointer-events:none;
      background: radial-gradient(closest-side at 50% 45%, rgba(0,0,0,0), rgba(0,0,0,.35) 70%, rgba(0,0,0,.58) 100%);
      z-index: 49;
    }

    /* FX canvas */
    #fx{
      position:fixed; inset:0;
      z-index: 1;
      pointer-events:none;
      opacity:.95;
    }

    /* Parallax world */
    .world{
      position:fixed; inset:0;
      z-index: 2;
      pointer-events:none;
      overflow:hidden;
    }
    .layer{
      position:absolute; inset:-10% -10%;
      will-change: transform;
      transform: translate3d(0,0,0);
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
      opacity:1;
    }
    .nebula{
      background:
        radial-gradient(900px 480px at 18% 10%, rgba(139,92,255,.14), transparent 62%),
        radial-gradient(900px 480px at 76% 18%, rgba(53,255,214,.10), transparent 60%),
        radial-gradient(700px 420px at 52% 36%, rgba(36,200,255,.10), transparent 60%),
        radial-gradient(900px 520px at 50% 120%, rgba(183,140,57,.08), transparent 62%);
      opacity:.9;
    }
    .skyline{
      bottom:-2%;
      top:auto;
      height: 56%;
      background:
        linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.0) 65%),
        radial-gradient(900px 340px at 40% 10%, rgba(53,255,214,.10), transparent 60%),
        radial-gradient(900px 340px at 68% 12%, rgba(36,200,255,.08), transparent 60%);
      opacity: .95;
    }
    .skyline svg{
      width:120%;
      height:100%;
      display:block;
      transform: translateX(-8%);
    }
    .pipes{
      bottom:-6%;
      top:auto;
      height: 42%;
      opacity:.95;
    }
    .pipes svg{
      width:120%;
      height:100%;
      display:block;
      transform: translateX(-10%);
    }
    .fog{
      position:absolute; left:-20%; right:-20%;
      bottom: 14%;
      height: 140px;
      background:
        radial-gradient(180px 70px at 10% 60%, rgba(255,255,255,.08), transparent 70%),
        radial-gradient(240px 90px at 35% 40%, rgba(53,255,214,.07), transparent 70%),
        radial-gradient(260px 90px at 60% 55%, rgba(36,200,255,.06), transparent 70%),
        radial-gradient(220px 80px at 85% 45%, rgba(255,255,255,.06), transparent 70%);
      filter: blur(10px);
      opacity:.55;
      animation: drift 18s linear infinite;
    }
    @keyframes drift{
      0%{ transform: translateX(-2%); }
      50%{ transform: translateX(2%); }
      100%{ transform: translateX(-2%); }
    }

    /* Layout */
    .wrap{
      position:relative;
      z-index: 10;
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 42px 18px 56px;
    }
    .shell{
      width: min(1180px, 100%);
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 980px){
      .shell{ grid-template-columns: 1fr; }
    }

    /* Panels */
    .panel{
      background: linear-gradient(180deg, rgba(14,24,60,.72), rgba(7,12,30,.70));
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(700px 260px at 20% 0%, rgba(53,255,214,.14), transparent 60%),
        radial-gradient(700px 260px at 80% 10%, rgba(36,200,255,.12), transparent 60%),
        radial-gradient(520px 220px at 50% 120%, rgba(183,140,57,.10), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .panel::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,0) 18%, rgba(255,255,255,.04) 40%, rgba(255,255,255,0) 64%, rgba(255,255,255,.05));
      opacity:.22;
      pointer-events:none;
      transform: translateX(-40%);
      animation: sheen 9s ease-in-out infinite;
    }
    @keyframes sheen{
      0%{ transform: translateX(-40%); }
      50%{ transform: translateX(40%); }
      100%{ transform: translateX(-40%); }
    }

    .hd{
      position:relative;
      padding: 18px 18px 12px 18px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }
    .brand h1{
      margin:0;
      font-family: var(--serif);
      font-size: 24px;
      letter-spacing:.5px;
      line-height:1.05;
    }
    .brand h1 .glow{
      color: var(--mako);
      text-shadow: 0 0 18px rgba(53,255,214,.55), 0 0 40px rgba(36,200,255,.18);
    }
    .brand .sub{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      letter-spacing:.08em;
      text-transform: uppercase;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .hud{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .badge{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.88);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding: 7px 10px;
      border-radius: 999px;
      display:inline-flex;
      gap: 8px;
      align-items:center;
      user-select:none;
    }
    .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--mako);
      box-shadow: 0 0 12px rgba(53,255,214,.65);
    }
    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--ink);
      border-radius: 999px;
      padding: 8px 10px;
      font-family: var(--mono);
      font-size: 12px;
      cursor:pointer;
      transition: transform .08s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
      user-select:none;
    }
    .btn:hover{
      border-color: rgba(53,255,214,.34);
      box-shadow: 0 0 0 4px rgba(53,255,214,.10);
      background: rgba(53,255,214,.06);
    }
    .btn:active{ transform: translateY(1px); }

    .bd{
      position:relative;
      padding: 16px 18px 18px 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    /* Tool menu grid */
    .menu{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }
    @media (max-width: 560px){
      .menu{ grid-template-columns: 1fr; }
    }

    .card{
      position:relative;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(6,10,26,.52), rgba(0,0,0,.18));
      box-shadow: var(--shadow2);
      overflow:hidden;
      transform: translateZ(0);
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
    }
    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(420px 160px at 18% 0%, rgba(53,255,214,.16), transparent 60%),
        radial-gradient(420px 160px at 88% 18%, rgba(36,200,255,.12), transparent 60%),
        radial-gradient(320px 140px at 50% 120%, rgba(183,140,57,.10), transparent 60%);
      opacity:.8;
      pointer-events:none;
    }
    .card::after{
      content:"";
      position:absolute; inset:-1px;
      border-radius: var(--radius);
      background: linear-gradient(120deg, rgba(53,255,214,.0), rgba(53,255,214,.18), rgba(183,140,57,.10), rgba(53,255,214,.0));
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
    }

    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(53,255,214,.38);
      box-shadow: 0 22px 70px rgba(0,0,0,.58);
    }
    .card:hover::after{ opacity:.85; }

    .card a{
      display:block;
      text-decoration:none;
      color:inherit;
      padding: 14px 14px 14px 14px;
      outline:none;
    }
    .card a:focus-visible{
      box-shadow: 0 0 0 4px rgba(53,255,214,.22);
      border-radius: var(--radius);
    }

    .topline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .title{
      font-weight: 900;
      letter-spacing:.3px;
      font-size: 15px;
      line-height:1.15;
      margin: 0 0 6px 0;
      display:flex;
      gap: 10px;
      align-items:center;
      min-width: 0;
    }
    .title .icon{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      display:grid;
      place-items:center;
      box-shadow: inset 0 0 0 1px rgba(53,255,214,.10);
      position:relative;
      overflow:hidden;
      font-family: var(--mono);
      font-weight: 900;
    }
    .title .icon::before{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 35% 35%, rgba(53,255,214,.24), transparent 60%),
                  radial-gradient(circle at 70% 65%, rgba(36,200,255,.18), transparent 55%);
      filter: blur(2px);
      opacity:.95;
    }
    .title .name{
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .tag{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.88);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding: 6px 9px;
      border-radius: 999px;
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .desc{
      margin: 0;
      color: rgba(234,242,255,.84);
      font-size: 12.5px;
      line-height: 1.35;
    }
    .desc span{ color: var(--muted); }

    .cursor{
      position:absolute;
      right: 14px;
      bottom: 12px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,242,255,.78);
      opacity: 0;
      transform: translateX(4px);
      transition: opacity .16s ease, transform .16s ease;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .card:hover .cursor,
    .card[data-active="true"] .cursor{
      opacity: 1;
      transform: translateX(0);
    }
    .caret{
      width: 10px; height: 10px;
      border-left: 2px solid var(--mako);
      border-bottom: 2px solid var(--mako);
      transform: rotate(45deg);
      filter: drop-shadow(0 0 10px rgba(53,255,214,.55));
      animation: blink 1.05s steps(2,end) infinite;
    }
    @keyframes blink{
      0%,40%{ opacity:.25; }
      55%,100%{ opacity:1; }
    }

    /* Side column cards */
    .side{
      display:flex;
      flex-direction:column;
      gap: 18px;
    }
    .mini{
      background: linear-gradient(180deg, rgba(10,16,40,.65), rgba(0,0,0,.18));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius2);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .mini::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(700px 260px at 40% -10%, rgba(53,255,214,.16), transparent 60%),
        radial-gradient(700px 260px at 80% 0%, rgba(139,92,255,.10), transparent 60%),
        radial-gradient(700px 260px at 50% 120%, rgba(183,140,57,.10), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .mini .mh{
      padding: 14px 14px 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      position:relative;
    }
    .mini .mh h2{
      margin:0;
      font-size: 12px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(234,242,255,.92);
      font-weight: 900;
      font-family: var(--mono);
    }
    .mini .mh .lvl{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.78);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      white-space: nowrap;
    }
    .mini .mb{
      position:relative;
      padding: 14px;
      display:grid;
      gap: 12px;
    }

    .meter{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 12px;
    }
    .meterTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.78);
      margin-bottom: 10px;
    }
    .bar{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      position:relative;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 72%;
      background: linear-gradient(90deg, rgba(53,255,214,.0), rgba(53,255,214,.90), rgba(36,200,255,.75));
      box-shadow: 0 0 18px rgba(53,255,214,.45);
      border-radius: 999px;
      animation: charge 5.6s ease-in-out infinite;
    }
    @keyframes charge{
      0%{ width: 58%; filter:hue-rotate(0deg); }
      50%{ width: 86%; filter:hue-rotate(18deg); }
      100%{ width: 58%; filter:hue-rotate(0deg); }
    }

    .log{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding: 12px;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.82);
      line-height: 1.35;
    }
    .log .k{ color: rgba(53,255,214,.92); }
    .log .w{ color: rgba(183,140,57,.92); }
    .log .m{ color: rgba(169,182,214,.95); }

    /* Agenda UI */
    .field{
      display:grid;
      gap: 6px;
    }
    .field label{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.08em;
      text-transform: uppercase;
      color: rgba(234,242,255,.80);
    }
    input[type="date"], textarea{
      width:100%;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--ink);
      border-radius: 14px;
      padding: 10px 10px;
      font-family: var(--mono);
      font-size: 12px;
      outline:none;
      transition: box-shadow .18s ease, border-color .18s ease, background .18s ease;
    }
    textarea{
      min-height: 120px;
      resize: vertical;
      line-height: 1.35;
    }
    input[type="date"]:focus, textarea:focus{
      border-color: rgba(53,255,214,.34);
      box-shadow: 0 0 0 4px rgba(53,255,214,.12);
      background: rgba(53,255,214,.05);
    }
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    .row3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    @media (max-width: 520px){
      .row2,.row3{ grid-template-columns: 1fr; }
    }
    .hint{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(169,182,214,.90);
      opacity:.95;
    }
    .btnRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .btn2{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--ink);
      border-radius: 14px;
      padding: 10px 10px;
      font-family: var(--mono);
      font-size: 12px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing:.04em;
      text-transform: uppercase;
      transition: transform .08s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
      user-select:none;
    }
    .btn2:hover{
      border-color: rgba(53,255,214,.34);
      box-shadow: 0 0 0 4px rgba(53,255,214,.10);
      background: rgba(53,255,214,.06);
    }
    .btn2:active{ transform: translateY(1px); }

    .btn2.primary{
      border-color: rgba(53,255,214,.30);
      background: rgba(53,255,214,.10);
    }
    .btn2.danger{
      border-color: rgba(255,92,122,.26);
      background: rgba(255,92,122,.08);
    }

    .days{
      display:grid;
      gap: 8px;
    }
    .dayItem{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      border-radius: 14px;
      padding: 10px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:flex-start;
      cursor:pointer;
      transition: border-color .18s ease, box-shadow .18s ease, transform .12s ease, background .18s ease;
      user-select:none;
    }
    .dayItem:hover{
      border-color: rgba(53,255,214,.28);
      box-shadow: 0 0 0 4px rgba(53,255,214,.08);
      background: rgba(53,255,214,.04);
      transform: translateY(-1px);
    }
    .dayLeft{
      min-width:0;
    }
    .dayTitle{
      font-family: var(--mono);
      font-weight: 900;
      letter-spacing:.06em;
      text-transform: uppercase;
      font-size: 11px;
      color: rgba(234,242,255,.90);
      margin-bottom: 4px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .dayPreview{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(169,182,214,.95);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    .pill{
      font-family: var(--mono);
      font-size: 11px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      padding: 6px 9px;
      border-radius: 999px;
      white-space: nowrap;
      color: rgba(234,242,255,.82);
    }
    .pill.on{
      border-color: rgba(53,255,214,.26);
      background: rgba(53,255,214,.08);
      color: rgba(234,242,255,.92);
    }

    .foot{
      margin-top: 12px;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,242,255,.70);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .foot a{
      color: rgba(53,255,214,.92);
      text-decoration:none;
      border-bottom: 1px dotted rgba(53,255,214,.55);
    }
    .foot a:hover{ border-bottom-style: solid; }

    @media (prefers-reduced-motion: reduce){
      .panel::after, .fog, .bar > i { animation: none !important; }
      .card, .btn, .btn2, .dayItem { transition:none !important; }
      #fx{ display:none; }
    }
  </style>
</head>

<body class="crt">
  <canvas id="fx" aria-hidden="true"></canvas>

  <div class="world" aria-hidden="true">
    <div class="layer nebula" id="layerNebula"></div>

    <div class="layer skyline" id="layerSky">
      <svg viewBox="0 0 1200 500" preserveAspectRatio="xMidYMax slice">
        <defs>
          <linearGradient id="gSky" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="#0b1637" stop-opacity="0.0"/>
            <stop offset="1" stop-color="#000" stop-opacity="0.62"/>
          </linearGradient>

          <linearGradient id="gCity" x1="0" x2="1" y1="0" y2="0">
            <stop offset="0" stop-color="#061026" stop-opacity="0.95"/>
            <stop offset="0.5" stop-color="#040a18" stop-opacity="0.98"/>
            <stop offset="1" stop-color="#02040d" stop-opacity="0.98"/>
          </linearGradient>

          <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
            <feGaussianBlur stdDeviation="6" result="b"/>
            <feColorMatrix type="matrix" values="
              1 0 0 0 0
              0 1 0 0 0
              0 0 1 0 0
              0 0 0 .35 0" />
            <feMerge>
              <feMergeNode in="b"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <rect width="1200" height="500" fill="url(#gSky)"/>
        <path d="M0,360 C120,330 190,360 310,340 C410,325 470,355 600,330 C770,296 840,350 980,328 C1070,314 1120,330 1200,320 L1200,500 L0,500 Z"
              fill="rgba(0,0,0,.55)"/>

        <g fill="url(#gCity)">
          <rect x="30"  y="230" width="70" height="170" rx="6"/>
          <rect x="110" y="190" width="90" height="210" rx="6"/>
          <rect x="210" y="250" width="64" height="150" rx="6"/>
          <rect x="280" y="170" width="120" height="230" rx="6"/>
          <rect x="410" y="210" width="90" height="190" rx="6"/>
          <rect x="510" y="150" width="130" height="250" rx="6"/>
          <rect x="650" y="220" width="80" height="180" rx="6"/>
          <rect x="740" y="180" width="140" height="220" rx="6"/>
          <rect x="890" y="240" width="90" height="160" rx="6"/>
          <rect x="990" y="160" width="140" height="240" rx="6"/>
          <rect x="1140" y="260" width="60" height="140" rx="6"/>
        </g>

        <g filter="url(#glow)">
          <path d="M520 130 L550 90 L580 130 L580 400 L520 400 Z" fill="rgba(53,255,214,.12)"/>
          <path d="M780 160 L800 128 L822 160 L822 400 L780 400 Z" fill="rgba(36,200,255,.10)"/>
        </g>

        <g opacity="0.55">
          <g fill="rgba(215,179,106,.35)">
            <circle cx="150" cy="260" r="2"/>
            <circle cx="165" cy="285" r="2"/>
            <circle cx="180" cy="310" r="2"/>
            <circle cx="600" cy="220" r="2"/>
            <circle cx="615" cy="246" r="2"/>
            <circle cx="630" cy="270" r="2"/>
            <circle cx="1040" cy="235" r="2"/>
            <circle cx="1060" cy="260" r="2"/>
            <circle cx="1080" cy="285" r="2"/>
          </g>
        </g>
      </svg>
      <div class="fog"></div>
    </div>

    <div class="layer pipes" id="layerPipes">
      <svg viewBox="0 0 1200 420" preserveAspectRatio="xMidYMax slice">
        <defs>
          <linearGradient id="gRidge" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="#071027" stop-opacity="0.0"/>
            <stop offset="0.4" stop-color="#040a18" stop-opacity="0.7"/>
            <stop offset="1" stop-color="#02040d" stop-opacity="1"/>
          </linearGradient>
          <linearGradient id="gPipe" x1="0" x2="1">
            <stop offset="0" stop-color="#2b2a2f"/>
            <stop offset="0.5" stop-color="#1b1a20"/>
            <stop offset="1" stop-color="#2c2a30"/>
          </linearGradient>
          <linearGradient id="gBrass" x1="0" x2="1">
            <stop offset="0" stop-color="#d7b36a" stop-opacity="0.55"/>
            <stop offset="0.5" stop-color="#b88c39" stop-opacity="0.55"/>
            <stop offset="1" stop-color="#d7b36a" stop-opacity="0.55"/>
          </linearGradient>
          <filter id="mGlow" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="8" result="b"/>
            <feMerge>
              <feMergeNode in="b"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <path d="M0,240 C120,220 220,260 340,240 C470,218 580,260 710,238 C860,214 980,270 1200,240 L1200,420 L0,420 Z"
              fill="url(#gRidge)"/>

        <g opacity="0.95">
          <path d="M-40,300 C180,260 280,340 520,300 C760,260 880,340 1260,280"
                fill="none" stroke="url(#gPipe)" stroke-width="34" stroke-linecap="round"/>
          <path d="M-40,300 C180,260 280,340 520,300 C760,260 880,340 1260,280"
                fill="none" stroke="rgba(215,179,106,.35)" stroke-width="4" stroke-linecap="round"/>
          <path d="M40,360 C260,330 420,390 660,352 C880,320 980,382 1220,340"
                fill="none" stroke="url(#gPipe)" stroke-width="24" stroke-linecap="round"/>
          <path d="M40,360 C260,330 420,390 660,352 C880,320 980,382 1220,340"
                fill="none" stroke="rgba(53,255,214,.22)" stroke-width="3" stroke-linecap="round"/>
        </g>

        <g filter="url(#mGlow)">
          <circle cx="240" cy="272" r="18" fill="rgba(53,255,214,.25)"/>
          <circle cx="240" cy="272" r="8" fill="rgba(53,255,214,.55)"/>
          <path d="M240 290 L240 420" stroke="rgba(53,255,214,.25)" stroke-width="4"/>
        </g>

        <g id="gears" opacity="0.85">
          <g transform="translate(920 292)">
            <circle r="34" fill="rgba(0,0,0,.22)" stroke="url(#gBrass)" stroke-width="3"/>
            <circle r="12" fill="rgba(0,0,0,.30)" stroke="rgba(215,179,106,.45)" stroke-width="2"/>
            <g fill="rgba(215,179,106,.45)">
              <rect x="-3" y="-44" width="6" height="10" rx="2"/>
              <rect x="-3" y="34" width="6" height="10" rx="2"/>
              <rect x="-44" y="-3" width="10" height="6" rx="2"/>
              <rect x="34" y="-3" width="10" height="6" rx="2"/>
              <rect x="26" y="-34" width="8" height="6" rx="2" transform="rotate(45)"/>
              <rect x="-34" y="-34" width="8" height="6" rx="2" transform="rotate(135)"/>
              <rect x="-34" y="26" width="8" height="6" rx="2" transform="rotate(225)"/>
              <rect x="26" y="26" width="8" height="6" rx="2" transform="rotate(315)"/>
            </g>
          </g>

          <g transform="translate(1010 330)">
            <circle r="22" fill="rgba(0,0,0,.22)" stroke="rgba(215,179,106,.40)" stroke-width="2.5"/>
            <circle r="8" fill="rgba(0,0,0,.30)" stroke="rgba(215,179,106,.35)" stroke-width="2"/>
            <g fill="rgba(215,179,106,.40)">
              <rect x="-2.5" y="-30" width="5" height="8" rx="2"/>
              <rect x="-2.5" y="22" width="5" height="8" rx="2"/>
              <rect x="-30" y="-2.5" width="8" height="5" rx="2"/>
              <rect x="22" y="-2.5" width="8" height="5" rx="2"/>
            </g>
          </g>
        </g>
      </svg>
    </div>
  </div>

  <main class="wrap">
    <section class="shell" aria-label="Dashboard">
      <!-- MAIN PANEL -->
      <div class="panel">
        <div class="hd">
          <div class="brand">
            <h1><span class="glow">GEFFEN // DAILY DASHBOARD</span></h1>
            <div class="sub">1993 console menu • local save • ↑ ↓ enter • 1–8 quick launch</div>
          </div>
          <div class="hud">
            <span class="badge"><span class="dot"></span> ONLINE</span>
            <button class="btn" id="toggleFx" type="button" aria-pressed="true" title="Toggle particles (P)">FX: ON</button>
            <button class="btn" id="toggleTilt" type="button" aria-pressed="true" title="Toggle parallax (T)">TILT: ON</button>
          </div>
        </div>

        <div class="bd">
          <div class="menu" id="menu" role="list">
            <!-- 1 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/class-discussion/" target="_blank" rel="noopener"
                 data-key="1" data-name="Discussion Tracker">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">◎</span>
                    <span class="name">Discussion Tracker</span>
                  </div>
                  <span class="tag">LIVE</span>
                </div>
                <p class="desc">Track talk-time + quality in real time. <span>Fast keyboard workflow.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 2 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/SC/" target="_blank" rel="noopener"
                 data-key="2" data-name="Seating Chart">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">▦</span>
                    <span class="name">Seating Chart</span>
                  </div>
                  <span class="tag">ROOM</span>
                </div>
                <p class="desc">Build irregular desk layouts. <span>Legible, flexible, printable.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 3 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/rubric/" target="_blank" rel="noopener"
                 data-key="3" data-name="Rubric Generator">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">≡</span>
                    <span class="name">Rubric</span>
                  </div>
                  <span class="tag">GRADE</span>
                </div>
                <p class="desc">Spin up clean rubrics fast. <span>Save, tweak, share.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 4 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/uc/" target="_blank" rel="noopener"
                 data-key="4" data-name="Unit Calendar">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">⌁</span>
                    <span class="name">Unit Calendar</span>
                  </div>
                  <span class="tag">PLAN</span>
                </div>
                <p class="desc">Blue/Gold waterfall generator. <span>Blackouts, export, sanity.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 5 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/mafia/" target="_blank" rel="noopener"
                 data-key="5" data-name="Mafia">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">✶</span>
                    <span class="name">Mafia</span>
                  </div>
                  <span class="tag">GAME</span>
                </div>
                <p class="desc">Run social-deduction cleanly. <span>Timer + roles + pacing.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 6 -->
            <div class="card" role="listitem">
              <a href="https://amhagler.github.io/tr/" target="_blank" rel="noopener"
                 data-key="6" data-name="Trivia">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">◆</span>
                    <span class="name">Trivia</span>
                  </div>
                  <span class="tag">BOWL</span>
                </div>
                <p class="desc">Your GEFFEN BOWL engine. <span>Boards, teams, projector vibes.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 7: Portal -->
            <div class="card" role="listitem">
              <a href="https://geffenacademy.myschoolapp.com/app#login" target="_blank" rel="noopener"
                 data-key="7" data-name="Portal">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">⎈</span>
                    <span class="name">Portal</span>
                  </div>
                  <span class="tag">LOGIN</span>
                </div>
                <p class="desc">MySchoolApp portal entry. <span>One click. No wandering tabs.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>

            <!-- 8: Gradebook -->
            <div class="card" role="listitem">
              <a href="https://geffenacademy.myschoolapp.com/sis-gradebook/gradebook/27966135?svcid=edu&addin=1" target="_blank" rel="noopener"
                 data-key="8" data-name="Gradebook">
                <div class="topline">
                  <div class="title">
                    <span class="icon" aria-hidden="true">⌗</span>
                    <span class="name">Gradebook</span>
                  </div>
                  <span class="tag">SIS</span>
                </div>
                <p class="desc">Direct jump to the gradebook view. <span>Less portal archaeology.</span></p>
                <div class="cursor"><span class="caret"></span> ENTER</div>
              </a>
            </div>
          </div>

          <div class="foot">
            <div>
              <span style="color:rgba(215,179,106,.92)">Tip:</span>
              Press <b>1–8</b> to launch • <b>P</b> FX • <b>T</b> tilt • <b>Alt+S</b> save agenda
            </div>
            <div>
              <a href="#" id="focusFirst">Focus menu</a>
            </div>
          </div>
        </div>
      </div>

      <!-- SIDE: STATUS + AGENDA -->
      <aside class="side">
        <div class="mini">
          <div class="mh">
            <h2>Reactor Status</h2>
            <div class="lvl" id="lvl">MAKO FLOW: 72%</div>
          </div>
          <div class="mb">
            <div class="meter">
              <div class="meterTop">
                <span>ENERGY GRID</span>
                <span id="clock">--:--:--</span>
              </div>
              <div class="bar" aria-hidden="true"><i></i></div>
            </div>

            <div class="log" id="log">
              <div><span class="k">BOOT</span> <span class="m">Initializing dashboard...</span></div>
              <div><span class="k">LINK</span> <span class="m">Eight endpoints detected.</span></div>
              <div><span class="w">NOTE</span> <span class="m">Agenda saves locally (this browser only).</span></div>
              <div><span class="k">READY</span> <span class="m">Awaiting command.</span></div>
            </div>
          </div>
        </div>

        <div class="mini" id="agendaPanel">
          <div class="mh">
            <h2>Daily Agenda</h2>
            <div class="lvl" id="agendaStatus">UNSAVED</div>
          </div>

          <div class="mb">
            <div class="row2">
              <div class="field">
                <label for="agendaDate">Date</label>
                <input type="date" id="agendaDate" />
              </div>
              <div class="field">
                <label>Quick</label>
                <div class="btnRow">
                  <button class="btn2" type="button" id="todayBtn">Today</button>
                  <button class="btn2" type="button" id="nextSchoolBtn">Next school day</button>
                </div>
              </div>
            </div>

            <div class="field">
              <label for="agendaText">Agenda</label>
              <textarea id="agendaText" placeholder="Type your daily plan here.&#10;&#10;Suggested format:&#10;1) Opening: ...&#10;2) Mini-lesson: ...&#10;3) Activity: ...&#10;HW: ..."></textarea>
              <div class="hint">Autosaves to this browser when you click “Save.” (Export if you want a backup.)</div>
            </div>

            <div class="btnRow">
              <button class="btn2 primary" type="button" id="saveAgendaBtn">Save</button>
              <button class="btn2" type="button" id="clearAgendaBtn">Clear</button>
              <button class="btn2" type="button" id="exportAgendaBtn">Export</button>
              <label class="btn2" style="display:inline-flex;align-items:center;gap:10px;cursor:pointer;">
                Import
                <input type="file" id="importAgendaFile" accept="application/json,.json" style="display:none" />
              </label>
            </div>

            <div class="field">
              <label>Next 5 school days</label>
              <div class="days" id="nextDays"></div>
              <div class="hint">Click a day to load/edit it.</div>
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <script>
    /***********************
     * Particles (stars + sparks)
     ***********************/
    const canvas = document.getElementById('fx');
    const ctx = canvas.getContext('2d', { alpha:true });

    let W = 0, H = 0, DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    let particlesOn = true;

    function resize(){
      W = window.innerWidth;
      H = window.innerHeight;
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + "px";
      canvas.style.height = H + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resize, { passive:true });
    resize();

    const rand = (a,b)=> a + Math.random()*(b-a);

    const stars = Array.from({length: 140}, () => ({
      x: rand(0,W),
      y: rand(0,H),
      r: rand(0.6, 1.8),
      s: rand(0.08, 0.28),
      a: rand(0.25, 0.75),
      hue: rand(175, 205)
    }));

    const sparks = Array.from({length: 36}, () => ({
      x: rand(0,W),
      y: rand(H*0.2, H*0.95),
      vx: rand(-0.22, 0.22),
      vy: rand(-0.55, -0.18),
      life: rand(40, 110),
      t: 0
    }));

    function draw(){
      if (!particlesOn){
        ctx.clearRect(0,0,W,H);
        return;
      }
      ctx.clearRect(0,0,W,H);

      for (const st of stars){
        st.y += st.s;
        if (st.y > H + 10){
          st.y = -10;
          st.x = rand(0,W);
        }
        const tw = 0.55 + 0.45 * Math.sin((st.y*0.02) + (st.x*0.01));
        const alpha = st.a * tw;

        ctx.beginPath();
        ctx.fillStyle = `hsla(${st.hue}, 95%, 78%, ${alpha})`;
        ctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
        ctx.fill();
      }

      for (const sp of sparks){
        sp.t++;
        sp.x += sp.vx;
        sp.y += sp.vy;
        sp.vy -= 0.004;
        const p = sp.t / sp.life;

        const a = Math.max(0, 0.55 * (1 - p));
        const size = 2.2 + 2.8*(1-p);

        ctx.beginPath();
        ctx.fillStyle = `rgba(53,255,214,${a})`;
        ctx.arc(sp.x, sp.y, size, 0, Math.PI*2);
        ctx.fill();

        if (sp.t >= sp.life || sp.y < -40 || sp.x < -40 || sp.x > W+40){
          sp.x = rand(0,W);
          sp.y = rand(H*0.55, H*0.98);
          sp.vx = rand(-0.22, 0.22);
          sp.vy = rand(-0.55, -0.18);
          sp.life = rand(40, 110);
          sp.t = 0;
        }
      }
    }

    let last = 0;
    function loop(ts){
      const dt = ts - last; last = ts;
      draw(dt);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    /***********************
     * Parallax / tilt
     ***********************/
    let tiltOn = true;
    const layerNebula = document.getElementById('layerNebula');
    const layerSky = document.getElementById('layerSky');
    const layerPipes = document.getElementById('layerPipes');

    let mx = 0, my = 0;
    window.addEventListener('mousemove', (e) => {
      mx = (e.clientX / window.innerWidth) * 2 - 1;
      my = (e.clientY / window.innerHeight) * 2 - 1;
    }, { passive:true });

    function parallax(){
      if (!tiltOn){
        layerNebula.style.transform = 'translate3d(0,0,0)';
        layerSky.style.transform = 'translate3d(0,0,0)';
        layerPipes.style.transform = 'translate3d(0,0,0)';
      } else {
        layerNebula.style.transform = `translate3d(${mx*10}px, ${my*8}px, 0)`;
        layerSky.style.transform = `translate3d(${mx*18}px, ${my*12}px, 0)`;
        layerPipes.style.transform = `translate3d(${mx*28}px, ${my*18}px, 0)`;
      }
      requestAnimationFrame(parallax);
    }
    requestAnimationFrame(parallax);

    /***********************
     * Menu keyboard nav
     ***********************/
    const cards = Array.from(document.querySelectorAll('.card'));
    const links = cards.map(c => c.querySelector('a')).filter(Boolean);
    let activeIndex = 0;

    function bumpLog(tag, msg){
      const log = document.getElementById('log');
      const div = document.createElement('div');
      const t = tag.toUpperCase().padEnd(5,' ');
      div.innerHTML = `<span class="k">${t}</span> <span class="m">${msg}</span>`;
      log.appendChild(div);
      while (log.children.length > 7) log.removeChild(log.firstChild);
    }

    function setActive(i){
      activeIndex = (i + links.length) % links.length;
      cards.forEach((c, idx)=> c.dataset.active = (idx === activeIndex) ? "true" : "false");
      links[activeIndex].focus({ preventScroll:true });
      links[activeIndex].scrollIntoView({ block:"nearest", inline:"nearest", behavior:"smooth" });
      bumpLog(`SELECT`, links[activeIndex].dataset.name || 'Item');
    }

    window.addEventListener('load', () => {
      cards.forEach((c, idx)=> c.dataset.active = (idx === 0) ? "true" : "false");
    });

    document.addEventListener('keydown', (e) => {
      const tag = (document.activeElement && document.activeElement.tagName) ? document.activeElement.tagName.toLowerCase() : "";
      const typing = (tag === "input" || tag === "textarea" || tag === "select");
      // allow Alt+S even while typing
      if (e.altKey && e.key.toLowerCase() === 's'){
        e.preventDefault();
        saveAgenda();
        return;
      }
      if (typing) return;

      if (e.key === 'ArrowDown' || e.key === 'ArrowRight'){
        e.preventDefault();
        setActive(activeIndex + 1);
      }
      if (e.key === 'ArrowUp' || e.key === 'ArrowLeft'){
        e.preventDefault();
        setActive(activeIndex - 1);
      }
      if (e.key === 'Enter'){
        const a = links[activeIndex];
        if (a){
          bumpLog('OPEN', a.href);
          a.click();
        }
      }
      if (e.key === 'Escape'){
        if (document.activeElement) document.activeElement.blur();
      }

      // Quick launch 1–8
      if (/^[1-8]$/.test(e.key)){
        const idx = Number(e.key) - 1;
        if (links[idx]){
          bumpLog('OPEN', links[idx].dataset.name || `Tool ${e.key}`);
          window.open(links[idx].href, '_blank', 'noopener');
        }
      }

      if (e.key.toLowerCase() === 'p') toggleFx();
      if (e.key.toLowerCase() === 't') toggleTilt();
    });

    links.forEach((a, idx) => {
      a.addEventListener('mouseenter', ()=> {
        cards.forEach((c,i)=> c.dataset.active = (i===idx) ? "true" : "false");
        activeIndex = idx;
      });
      a.addEventListener('focus', ()=> {
        cards.forEach((c,i)=> c.dataset.active = (i===idx) ? "true" : "false");
        activeIndex = idx;
      });
      a.addEventListener('click', ()=> bumpLog('OPEN', a.dataset.name || a.href));
    });

    /***********************
     * HUD buttons
     ***********************/
    const fxBtn = document.getElementById('toggleFx');
    const tiltBtn = document.getElementById('toggleTilt');

    function toggleFx(){
      particlesOn = !particlesOn;
      fxBtn.textContent = `FX: ${particlesOn ? 'ON' : 'OFF'}`;
      fxBtn.setAttribute('aria-pressed', particlesOn ? 'true' : 'false');
      bumpLog('FX', particlesOn ? 'Particles enabled' : 'Particles disabled');
    }
    function toggleTilt(){
      tiltOn = !tiltOn;
      tiltBtn.textContent = `TILT: ${tiltOn ? 'ON' : 'OFF'}`;
      tiltBtn.setAttribute('aria-pressed', tiltOn ? 'true' : 'false');
      bumpLog('TILT', tiltOn ? 'Parallax enabled' : 'Parallax disabled');
    }
    fxBtn.addEventListener('click', toggleFx);
    tiltBtn.addEventListener('click', toggleTilt);

    document.getElementById('focusFirst').addEventListener('click', (e) => {
      e.preventDefault();
      setActive(0);
    });

    /***********************
     * Clock + mako level
     ***********************/
    const clockEl = document.getElementById('clock');
    const lvlEl = document.getElementById('lvl');
    function pad2(n){ return String(n).padStart(2,'0'); }
    function tick(){
      const d = new Date();
      clockEl.textContent = `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
      const pct = 72 + Math.round(10 * Math.sin(d.getTime()/1800));
      lvlEl.textContent = `MAKO FLOW: ${pct}%`;
      setTimeout(tick, 250);
    }
    tick();

    // start focus only after user action
    let armed = false;
    const arm = () => {
      if (armed) return;
      armed = true;
      setActive(0);
      bumpLog('READY', 'Menu focused');
      window.removeEventListener('pointerdown', arm);
      window.removeEventListener('keydown', arm);
    };
    window.addEventListener('pointerdown', arm, { once:true });
    window.addEventListener('keydown', arm, { once:true });

    /***********************
     * Daily Agenda (localStorage)
     ***********************/
    const AGENDA_KEY = "hagler_dashboard_agenda_v1"; // stores { "YYYY-MM-DD": "text..." }
    const agendaDate = document.getElementById('agendaDate');
    const agendaText = document.getElementById('agendaText');
    const agendaStatus = document.getElementById('agendaStatus');
    const nextDaysEl = document.getElementById('nextDays');

    function isoLocal(d){
      // local date -> YYYY-MM-DD
      const y = d.getFullYear();
      const m = pad2(d.getMonth()+1);
      const day = pad2(d.getDate());
      return `${y}-${m}-${day}`;
    }
    function parseISO(iso){
      const [y,m,d] = iso.split("-").map(Number);
      return new Date(y, m-1, d);
    }
    function isWeekend(d){
      const dow = d.getDay();
      return dow === 0 || dow === 6;
    }
    function getAgendaMap(){
      try{
        const raw = localStorage.getItem(AGENDA_KEY);
        if (!raw) return {};
        const obj = JSON.parse(raw);
        return (obj && typeof obj === "object") ? obj : {};
      } catch(e){
        return {};
      }
    }
    function setAgendaMap(map){
      localStorage.setItem(AGENDA_KEY, JSON.stringify(map));
    }

    function markSaved(saved){
      if (saved){
        agendaStatus.textContent = "SAVED";
        agendaStatus.style.borderColor = "rgba(53,255,214,.26)";
        agendaStatus.style.background = "rgba(53,255,214,.08)";
      } else {
        agendaStatus.textContent = "UNSAVED";
        agendaStatus.style.borderColor = "rgba(255,255,255,.14)";
        agendaStatus.style.background = "rgba(0,0,0,.14)";
      }
    }

    function loadAgendaForDate(iso){
      const map = getAgendaMap();
      agendaDate.value = iso;
      agendaText.value = map[iso] || "";
      markSaved(true);
      bumpLog("AGENDA", `Loaded ${iso}`);
      renderNextDays();
    }

    function saveAgenda(){
      const iso = agendaDate.value;
      if (!iso){
        alert("Pick a date first.");
        return;
      }
      const map = getAgendaMap();
      map[iso] = agendaText.value || "";
      setAgendaMap(map);
      markSaved(true);
      bumpLog("SAVE", `Agenda saved for ${iso}`);
      renderNextDays();
    }

    function clearAgenda(){
      const iso = agendaDate.value;
      if (!iso) return;
      const ok = confirm(`Clear agenda for ${iso}?`);
      if (!ok) return;

      const map = getAgendaMap();
      delete map[iso];
      setAgendaMap(map);
      agendaText.value = "";
      markSaved(true);
      bumpLog("CLEAR", `Agenda cleared for ${iso}`);
      renderNextDays();
    }

    function previewText(s){
      const t = (s || "").trim().replace(/\s+/g, " ");
      if (!t) return "—";
      return t.length > 44 ? t.slice(0, 44) + "…" : t;
    }

    function nextSchoolDay(fromDate){
      // For now: skip weekends. (We can add a “no school” list later if you want.)
      let d = new Date(fromDate.getTime());
      d.setDate(d.getDate()+1);
      while (isWeekend(d)){
        d.setDate(d.getDate()+1);
      }
      return d;
    }

    function nextNSchoolDays(startDate, n){
      const days = [];
      let d = new Date(startDate.getTime());
      // if startDate is weekend, jump to Monday
      while (isWeekend(d)){
        d.setDate(d.getDate()+1);
      }
      // include startDate as day 1
      days.push(new Date(d.getTime()));
      while (days.length < n){
        d = nextSchoolDay(d);
        days.push(new Date(d.getTime()));
      }
      return days;
    }

    function renderNextDays(){
      const map = getAgendaMap();
      nextDaysEl.innerHTML = "";

      const base = agendaDate.value ? parseISO(agendaDate.value) : new Date();
      const list = nextNSchoolDays(base, 5);

      list.forEach(d => {
        const iso = isoLocal(d);
        const dow = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];
        const label = `${dow} ${d.getMonth()+1}/${d.getDate()}`;
        const has = (map[iso] && map[iso].trim().length);

        const div = document.createElement('div');
        div.className = "dayItem";
        div.innerHTML = `
          <div class="dayLeft">
            <div class="dayTitle">${label} <span style="opacity:.75">(${iso})</span></div>
            <div class="dayPreview">${previewText(map[iso] || "")}</div>
          </div>
          <div class="pill ${has ? "on" : ""}">${has ? "SET" : "EMPTY"}</div>
        `;
        div.addEventListener('click', () => loadAgendaForDate(iso));
        nextDaysEl.appendChild(div);
      });
    }

    // dirty-state indicator
    let lastLoadedText = "";
    agendaText.addEventListener('input', () => {
      const now = agendaText.value;
      markSaved(now === lastLoadedText);
    });

    // Buttons
    document.getElementById('saveAgendaBtn').addEventListener('click', () => {
      saveAgenda();
      lastLoadedText = agendaText.value;
    });
    document.getElementById('clearAgendaBtn').addEventListener('click', () => {
      clearAgenda();
      lastLoadedText = agendaText.value;
    });

    document.getElementById('todayBtn').addEventListener('click', () => {
      const iso = isoLocal(new Date());
      loadAgendaForDate(iso);
      lastLoadedText = agendaText.value;
    });

    document.getElementById('nextSchoolBtn').addEventListener('click', () => {
      const base = agendaDate.value ? parseISO(agendaDate.value) : new Date();
      const nxt = nextSchoolDay(base);
      loadAgendaForDate(isoLocal(nxt));
      lastLoadedText = agendaText.value;
    });

    // Export / Import
    document.getElementById('exportAgendaBtn').addEventListener('click', () => {
      const map = getAgendaMap();
      const payload = {
        version: 1,
        exportedAt: new Date().toISOString(),
        agenda: map
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `hagler_agenda_export_${isoLocal(new Date())}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      bumpLog("EXPORT", "Agenda JSON downloaded");
    });

    document.getElementById('importAgendaFile').addEventListener('change', async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      try{
        const text = await file.text();
        const obj = JSON.parse(text);
        const incoming = obj && obj.agenda ? obj.agenda : null;
        if (!incoming || typeof incoming !== "object"){
          alert("That file doesn't look like an agenda export.");
          e.target.value = "";
          return;
        }
        const existing = getAgendaMap();
        // merge: imported overwrites existing on same dates
        const merged = { ...existing, ...incoming };
        setAgendaMap(merged);
        bumpLog("IMPORT", "Agenda merged into local storage");
        // reload current date
        const iso = agendaDate.value || isoLocal(new Date());
        loadAgendaForDate(iso);
        lastLoadedText = agendaText.value;
      } catch(err){
        alert("Import failed. (Not valid JSON?)");
      } finally {
        e.target.value = "";
      }
    });

    // Initialize agenda date to today
    (function initAgenda(){
      const iso = isoLocal(new Date());
      agendaDate.value = iso;
      const map = getAgendaMap();
      agendaText.value = map[iso] || "";
      lastLoadedText = agendaText.value;
      markSaved(true);
      renderNextDays();
    })();
  </script>
</body>
</html>
